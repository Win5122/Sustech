人工智能算法在定量金融领域的应用探索
Huang YuHang
 SUSTech CSE
 12011129@mail.sustech.edu.cn
 Zhao Ketai
 SUSTech CSE
 12110306@mail.sustech.edu.cn
 Li Ming
 SUSTech Mathematics
 12110435@mail.sustech.edu.cn
 January 7, 2024
 Luo Jiajun
 SUSTech CSE
 12012023@mail.sustech.edu.cn
 Liao Zetong
 SUSTech CSE
 12011417@mail.sustech.edu.cn
 1. 摘要
量化金融作为金融领域的一支新兴分支，通
过运用数学模型和统计分析，试图发现市场中的
规律性，并基于这些规律性制定交易策略。在过
去几十年的发展中，量化金融已经成为金融机构
和个人投资者的主要手段之一，而其逐渐崭露头
角的背后离不开人工智能技术的不断创新与应用。
我们梳理了量化金融的发展背景和历史沿革，探
讨了人工智能在该领域中的关键作用。重点对卷
积神经网络、随机森林、配对算法、与遗传算法在
量化金融中的应用进行了研究与实验。其中，卷
积神经网络以其强大的特征提取能力在量化模型
中展现出色，随机森林则通过集成学习有效地处
理复杂的市场数据。配对算法的应用使得投资组
合管理更为精准，而遗传算法在参数优化中展现
出强大的搜索和优化能力。这些人工智能技术的
整合为量化金融提供了新的解决方案，提高了交
易策略的稳定性和效益。未来，随着人工智能技
术的不断发展，量化金融领域将迎来更多创新与
突破，为投资者提供更可靠的决策支持。
关键词：量化金融、人工智能、卷积神经网络、随
机森林、配对算法、遗传算法
2. 背景
2.1. 量化金融及其历史发展
量化金融是一种利用数学模型、统计学和计
算机编程等技术手段来分析金融市场和制定投资
策略的方法。通过量化金融，投资者可以利用大
量的数据和算法来进行系统性的分析，以辅助决
策和优化投资组合。这种方法通常涉及大规模的
数据分析、模型构建和自动化交易执行。
其发展背景可以追溯到20世纪60年代和70
年代，当时学者们开始运用数学和计量经济学方
法来研究金融市场的行为，为量化金融金融积累
了早期理论。20 世纪 80 年代，当时计算机技术
的迅猛发展为大规模数据分析提供了可能，计算
机参与到金融交易之中，是量化金融的早起实践。
1987 年的黑色星期一股市崩盘成为量化金融发展
的一个关键时刻。这场崩盘促使投资者和机构更
加关注风险管理和模型化交易策略，引发了对量
化方法在金融领域应用的兴趣。1990年代，随着
计算机性能的提升和金融市场数据的广泛数字化，
量化金融进入了一个新的阶段。崭新的算法和数
学模型应运而生，为投资者提供了更准确和自动
化的交易工具。同时，对市场数据的高频率交易
（HFT）的兴起也推动了量化金融的快速发展 [1]
 [2]。2007-2008 年的全球金融危机再次推动了量化
金融的发展。危机爆发后，人们认识到传统的金
融模型在应对极端市场情况上的局限性[3]。因此，
对于更复杂、全面的风险模型和交易策略的需求
催生了更深入的量化金融研究[4]。随着时间的推
移，机器学习和人工智能技术的蓬勃发展为量化
金融领域注入了新的活力。这些技术的广泛应用
使得量化交易模型更加智能、灵活，并提高了对
金融市场动态变化的适应能力[5]。今天，量化金
融已经成为金融领域中不可或缺的一部分，为投
资者提供了更为精密和创新的交易工具。
2.2. 量化金融中的关键过程以及人工智能的
参与
现在的量化金融的工作流程已经相对成熟并
成体系化，其中主要涉及以下几个关键步骤，而人
工智能均可应用于量化金融的这些环节之中，并
在这些环节中发挥重要作用：
• 数据收集与清洗：数据是量化金融的素材。量
化金融的第一步就是获取市场数据、财务报
表等金融相关信息，并进行数据清洗，确保
数据的准确性和一致性。而人工智能技术可
以用于大规模数据的自动收集、清洗和处理，
提高数据处理的效率，同时通过算法识别异
常值，确保数据的质量。
• 特征工程：选择和构建合适的特征，以揭示
市场中的潜在模式和趋势。机器学习算法能
够自动提取关键特征，发现非线性关系，进
一步优化特征工程的过程。
• 模型开发与训练：基于已经收集的历史数据
以及选定的特征，开发量化模型，并进行训练
以使其适应市场的动态变化。人工智能技术，
特别是卷积神经网络和随机森林算法，可以
用于建立预测模型、时序模型等，可以通过
学习大量历史数据来发现模式，提高模型的
准确性。这一点也是量化金融区别于传统金
融手段的重要的不同点。
• 回测与优化：使用历史数据对开发的模型进
行回测，评估其性能，并根据结果对模型进
行优化。人工智能技术可用于自动化回测流
程，同时通过我们接下来要介绍的遗传算法
等优化算法寻找模型参数的最佳组合。
通过在这些关键步骤中整合人工智能技术，量化
金融能够更智能地应对复杂多变的金融市场环境，
提高决策的精度和效率。
3. 研究现状
3.1. 概述
之前的研究中验证了使用多种因子与某些机
器学习算法相结合，在预测股票收益率方面有显
著效能 [6][7]。本研究探讨了随机森林、卷积神
经网络、配对交易和遗传算法在量化金融中的应
用。通过数据回测实验，我们取得了令人满意的
结果，显示了这些算法在股票市场预测方面的潜
力和效能。这些研究结果为量化金融提供了新的
视角和方法，有望改进投资和交易策略的决策基
础。我们通过将算法的理论与本文的研究领域进
行结合，在前人的基础上开发了有较好性能的实
证模型，验证了算法的有效性，并且分析了部分
算法的局限性。我们还尝试从理论上分析有效性
和局限性的来源。本节将对这些算法本身和每一
个算法在量化金融中的建模方法也进行详细介绍。
3.2. 卷积神经网络
3.2.1. 概述
卷积神经网络（Convolutional Neural Net
work，CNN）在计算机视觉领域的成功应用引发
了对其在其他领域的研究兴趣[8]，其中包括金融
领域[9]。卷积神经网络具有一些独特的特点和优
势，这些特点在金融的量化分析领域尤其有价值，
特别是在处理股票序列数据方面：
• 局部感知能力：股价波动常受到局部事件和
因素的影响，如公司公告和宏观经济数据。
2
CNN 的卷积操作有助于捕获这些局部特征，
提高对短期波动的准确性。
• 参数共享：股价数据通常非平稳，数据有限。
CNN 通过参数共享降低参数数量，减少过拟
合风险，特别适用于数据稀缺的金融领域。
• 平移不变性：股价特征通常与时间相关，但
不依赖于特定时间点。CNN的平移不变性允
许模型在不考虑时间点的情况下捕捉到这些
特征，有助于识别趋势和模式。
• 层次性特征提取：股价数据包含多个层次的
信息，从短期波动到长期趋势。CNN的多层
结构逐渐提取不同层次的特征，例如第一层
捕捉短期波动，后续层捕捉更高级的趋势，有
助于理解复杂的股价结构。
3.2.2. 卷积神经网络在股票交易择时的应用
在过往的研究中，在限价订单簿（LOB）数据
的基础上，已经有不少研究[10][11] 在本研究中，
我们构建了一个股票涨跌预测模型，旨在利用市
场数据来预测股票的涨跌情况。我们将某支股票
的开盘价、收盘价、市值、市盈率和最高价作为输
入因子，并进行了标准化处理，以保证数据的一
致性和可比性。我们将每60天的数据作为一个输
入序列，然后预测下一个交易日的股票涨跌情况
作为输出。
模型的核心架构是一个具有两层卷积神经网
络（CNN）的深度学习模型。我们选择使用CNN
来捕捉输入序列中的序列特征，因为CNN在处
理序列数据方面具有出色的性能。每个卷积层后
面跟着ReLU 激活函数以引入非线性特性，并使
用Dropout 来减少过拟合的风险。接下来，我们
通过全连接层（FC）将卷积层提取的特征组合在
一起，然后经过ReLU 激活函数进一步处理。最
后的全连接层使用softmax 函数输出一个包含两
个元素的概率向量，表示股票涨跌的概率。
为了评估我们的模型性能，我们将数据集划
分为三个部分：训练集、测试集和验证回测集。具
体来说，我们选取了2005年至2018 年的数据作
为训练集，其中20%的数据用作测试集。而2019
年的数据则用于验证回测。在回测中，我们根据
模型的涨跌预测，在每个交易日采取相应的交易
策略。如果模型预测股票涨，我们买入1/3的资
金；如果模型预测股票跌，我们卖出1/3的仓位。
如果已满仓或空仓，则不做任何买卖操作。
模型性能与实验细节将在第四部分实验中讲
解。
Figure 1: 卷积神经网络模型架构
3.3. 随机森林
3.3.1. 概述
随机森林是一种集成算法，它属于 Bagging
类型，通过组合多个弱学习器（决策树），对弱学
习器的结果投票或取均值得到整体模型的最终结
果，使得整体模型的结果具有较高的精确度和泛
化性能。其之可以取得不错成绩，主要归功于“随
机”和“森林”，一个使它具有抗过拟合能力，一
个使它更加精准。
• 决策树：决策树是一种流程图形式的模型，用
于进行分类和回归分析。它通过树状图的结
构来表示在一个决策过程中的各种可能的结
果，以及导致这些结果的各种决策路径。日
3
常生活中，我们对于事物的认知都是基于特
征的判断与分类，譬如通过胎生与否可判断
哺乳动物，根据肚脐尖圆来挑选螃蟹公母。决
策树就是采用这样的思想，基于多个特征进
行分类决策。在树的每个结点处，根据特征的
表现通过某种规则分裂出下一层的叶子节点，
终端的叶子节点即为最终的分类结果。决策
树学习的关键是选择最优划分属性。随着逐
层划分，决策树分支结点所包含的样本类别
会逐渐趋于一致，从而得到最终分类。
• 基尼不纯度：决策树的分裂遵循基尼不纯度
的最大减少。节点的基尼不纯度是指，根据
节点中样本的分布对样本分类时，从节点中
随机选择的样本被分错的概率。因此，基尼
不纯度越小，样本的纯度越高。
• 自助采样：随机森林在构建每棵决策树时采
用自助采样方法。对于每棵树而言，从原始
训练数据中有放回地随机抽取样本，形成一
个新的训练数据集。这样就使得每棵决策树
的训练数据都略有不同，从而增加了模型的
多样性。
• 多数投票机制：在随机森林中，对于分类问
题，每棵决策树都投票给某个类别，最终的
预测结果是得票最多的类别。这种投票机制
对单棵决策树可能存在的错误做出了整体性
的修正，从而提高了模型的泛化能力。
3.3.2. 随机森林在选股中的应用
几十年来，对股票回报主要驱动因素的调查
一直备受关注。正如经典的金融理论所示，股票
回报以线性方式归因于基础基本面，包括系统风
险、市值、市净率等。相应的线性回归方案，结合
广泛发展的涵盖各种技术和基本方面的因子，构
成学术和行业领域金融建模的主要工具。股票选
择在投资组合管理中扮演着重要角色。股票选择
标准是复杂的，绝不符合科学标准。然而，新开
发的先进算法，如深度神经网络和基于树的模型，
相对于传统的因子加权排名系统，为股票选择效
率提供了新视角，从而导致显著的交易业绩。
决策树可用于各种机器学习应用。但是，为
了学习高度不规则的模式，生长得非常深的树往
往会过拟合训练集。数据中的轻微噪音可能导致
树以完全不同的方式生长。这是因为决策树具有
很低的偏差和很高的方差。随机森林通过在特征
空间的不同子空间上训练多个决策树来克服这个
问题，代价是稍微增加了偏差。这意味着森林中
的任何一棵树都没有看到整个训练数据。数据被
递归地分割成分区。在特定节点，通过对属性提
出问题来进行拆分。选择拆分标准是基于一些不
纯度度量，如香农熵或基尼不纯度。
我们调研了一些包含实验的随机森林选股论
文，从他们的实验结论中获取合适的参数。Zheng
 Tan 等人的工作 [12] 指出：树的数量对结果有显
著影响当树的数量设置为 60 时，夏普比率可达
2.75，同样，Sortino 和 Calmar 比率也能达到它
们的最大值。样本内oob分数随着树的数量稳步
增加，但随着树的数量接近120，趋势趋于平稳。
此外，随着样本类别数量的增加，样本外绩效投
资组合和对冲的NV都有所恶化，尤其是在2016
年和 2017 年，更多的样本类别导致超额回报减
少。另一篇是Khaidem L[13] 等人的工作，他们
的森林有30 颗树，对比了30,60,90 天的交易周
期，发现90天的效果最好。尽管我们的随机森林
建模是通过QuantConnect 平台的可视化平台实
现的，也就是说代码的实现细节可能和这两篇的
模型有出入，但调参时我们充分参考了两篇论文
实验部分的参数和结果。
3.4. 配对算法
3.4.1. 核心思想
配对交易[14, 15] 是一种基于统计、机器学习
或深度学习的套利的策略，其核心在于利用两种
证券价格之间的历史相关性进行套利。这种策略
的基本假设是，如果两种证券在过去的某段时间
内价格走势紧密相关，那么它们未来的价格走势
也将保持这种相关性。当这两种证券的价格差异
超出历史正常范围时，投资者会同时买入表现较
弱的证券并卖空表现较强的证券，期望未来这两
4
种证券的价格差异会回归到历史正常水平。这种
策略的优势在于其市场中性特性，即它的盈利不
受市场整体涨跌的影响。
在本段中，我们将会给出传统的基于统计量
的经典算法[14]，以及采用机器学习、利用多种聚
类算法辅助的新方案[15]。
3.4.2. 基于统计的配对交易算法
在Gatev 的工作中 [14]，配对交易的实施主
要基于历史价格数据的最小距离匹配。具体算法
如下：
• 股票对的选择：通过计算股票对之间的历史
价格归一化后的欧几里得距离，选择距离最
小的股票对作为交易对象。这种方法的核心
在于识别那些历史上价格走势紧密相关的股
票对，并利用这种相关性来预测未来的价格
走势[14]。
T
距离=
 t=1
 (P1,t − P2,t)2
其中，P1,t 和 P2,t 分别代表两只股票在时间
t 的价格。
• 交易信号的触发：当选定的股票对价格差异
超过设定的阈值时，触发交易信号。通常这
个阈值是基于历史价格差异的标准差来设定
的。
• 交易执行：在价格差异超过阈值时，投资者
会买入表现较弱的股票并卖空表现较强的股
票，等待价格差异回归正常。
此外，该工作还探讨了配对交易盈利的稳定
性，论文指出配对交易的盈利可能与执行此策略
的市场参与者的交易成本和做空能力有关。
3.4.3. 基于无监督学习的配对交易算法
另一个工作中[15]，提出了一种新的配对交易
策略，该策略利用无监督学习来识别股票对。与传
统的基于时间序列回报的配对交易策略不同，这
种方法结合了公司特征和价格信息来识别配对交
易的机会。
核心思想：传统的配对交易策略主要基于股
票的历史价格数据，而这项研究通过结合公司的
财务特征和市场表现等信息，使用无监督学习方
法来识别具有相似特征的股票对。这种方法的创
新之处在于，它不仅仅依赖于价格数据，而是结
合了更多维度的信息来发现价格走势上的相关性。
无监督学习算法选择：论文中采用了三种代
表性的聚类方法：k-means 聚类 [16, 17]、DB
SCAN[18] 和层次聚类 [19]。这些方法通过将股
票基于过去的回报和特征进行分组，从而识别出
潜在的配对交易机会。
• k-means 聚类：k-means 聚类 [16, 17] 通过最
小化簇内平方和（WCSS）来将数据点分配到
不同的簇中。
n
 WCSS=
 i=1
 k
 j=1
 zij||xi − µj||2
其中，xi 是数据点，µj 是簇j 的中心，zij 是
指示变量，如果数据点i属于簇j则为1，否
则为0。
• DBSCAN 聚类 [18]：DBSCAN 聚类基于高
密度区域的连续性来识别簇，将低密度区域
的点视为噪声。
• 层次聚类[19]：层次聚类是一种自底向上的
方法，初始将每个数据点视为一个单独的簇，
然后逐步合并最接近的簇。
d(A,B) = min(||a−b||) 对于所有a ∈ A,b ∈ B
其中，d(A,B) 是集群 A 和B之间的距离。
实验方案及结果：在论文实验中[15]，当过
去一个月的回报差异超出一个横截面标准差时，
执行买入表现较弱股票和卖空表现较强股票的策
略。应用于1980 年至2020 年的美国股市，通过
层次聚类构建的多空组合实现了年化平均回报率
24.8% 和夏普比率 2.69 的显著成绩。因此，论文
实验结果表明，引入无监督学习方案能显著提高
了配对交易策略的表现。
5
3.5. 遗传算法
计时间窗口中得到了正回报。
3.5.1. 概述
遗传算法是基于达尔文《进化论》中的遗传
以及自然选择现象之上的一种搜索算法。它最早
由Holland 于 1975 年提出 [20]。遗传算法将问题
的解视为个体，使用选择、交叉和变异三个遗传
算子模拟生物的遗传和变异现象。算法通过自然
选择淘汰不适应环境的个体最终得到最适应环境
的个体，即问题的最优解。
遗传算法只要求目标函数是可计算的，对问
题中约束、变量的数量、形式没有限制。因此，基
于遗传算法的量化交易策略较为灵活，形式多样
[21]。在本节中，我们将介绍两种不同的基于遗传
算法的交易策略。
3.5.2. 使用遗传算法生成交易策略
Hirabayashi 提出了一种自动生成交易策略的
方法[22]。该方法使用遗传算法寻找技术分析指
标[23] 的最佳参数以及组合方式，以此得到进行
买入或卖出操作的最佳时机。方法的主要流程如
下：
• 预先计算技术指标：预先计算在遗传算法运
行过程中需要用到的各技术指标的值。文章
中选择的技术指标为RSI1，RSI2，PD 以及
RR。
• 对个体进行编码：为了方便遗传算法的交叉
和突变操作，将一个个体使用一个二进制串
表示。每个二进制串主要分为买策略、卖策
略以及策略类型三个部分。其中买策略、卖
策略又由各技术指标参数的值，参数的位置，
以及技术指标之间的关系等多个部分组成。
• 遗传算法搜索：使用历史数据进行模拟交易，
将策略的收益作为个体的适应度。使用联赛
选择算法淘汰适应度较低的个体。经过多次
遗传、选择，得到最优的交易策略。
作者使用2005-2008 年之间的美元/日元，欧
元/日元以及澳元/日元的外汇数据测试得到的策
略的效果。实验显示自动生成的策略在固定的统
此方法使用遗传算法自动生成了有效的量化
交易策略。然而，由于使用的技术指标种类，技术
指标的参数范围等仍需要人工事先指定，不能做
到完全的策略自动生成。此外，由于此方法生成
的策略没有选股功能，仅能对单只股票/外汇进行
分析，故此方法生成策略的效果仍会受选择的股
票的走势所影响。
3.5.3. 使用遗传算法选择投资组合
针对单股票策略收益受股票波动影响大的问
题，Matsumura 提出了一种使用遗传算法选择投
资股票的方法[24]。该方法在使用遗传算法生成
策略之外，还加入了使用遗传算法生成最优投资
组合的功能。方法主要由两“层”搜索算法组成：
外层使用遗传算法寻找最优的投资组合，内层使
用遗传编程[25] 以及决策树算法，计算外层确定
的投资组合的收益情况。其中，内层算法的主要
流程与针对单只股票的策略生成方法相似，在此
不过多赘述。外层算法主要流程如下：
• 确定待选股票组：首先需要指定一个包含较
多股票的待选股票组，以便遗传算法能找到
较优的投资组合。
• 对投资组合进行编码：投资组合主要包含两
部分：选取的股票种类以及每种股票的投资
比例。其中投资比例为一个介于0与1之间
的实数，表示投入某种股票的资金占全部资
金的比例。例如，若本金为10万元，股票A
的投资比例为0.2，则投入股票 A 的资金为
2 万元。由于需要保证所有股票的投资比例
之和为 1，需要对投资比例进行正则化处理
[26]。
• 遗传算法搜索：对于每个投资组合，调用内
层搜索算法获得其收益情况。将投资组合的
收益情况视为个体的适应度，使用遗传算法
生成最优的投资组合。
作者从日经225中选取了56只待选股票。根
据1997-2008 年的交易数据，使用上述方法生成
了一个包含 10 只股票的交易策略。模拟交易显
6
4.1.2. 实验的训练与结果
示，生成的策略的收益率相较“买入并持有”策略
收益更高，且该策略风险性较低。
4. 实验
4.1. 卷积神经网络
4.1.1. 实验的数据与参数
模型的核心架构是一个具有两层卷积神经网
络（CNN）的深度学习模型。我们选择使用CNN
来捕捉输入序列中的序列特征，因为CNN在处
理序列数据方面具有出色的性能。每个卷积层后
面跟着ReLU 激活函数以引入非线性特性，并使
用Dropout 来减少过拟合的风险。接下来，我们
通过全连接层（FC）将卷积层提取的特征组合在
一起，然后经过ReLU 激活函数进一步处理。最
后的全连接层使用softmax 函数输出一个包含两
个元素的概率向量，表示股票涨跌的概率。模型
架构图在第三部分已经有所讲解。
我们的实验数据使用的是A股的股票，年份
是2005-2018。本实验将某支股票的 [开盘、收盘、
市值、市盈率、最高价]作为因子输入，然后标准
化处理。每连续60天的数据作为输入，涨跌预测
为输出，以滚动方式循环数据。涨跌的标签由这
60 天之后的那一个交易日与前一日的变化作为标
签。当后一天股价收盘价比前一天高，则标签为
涨，反之则为跌。
数据集分为训练集、测试集、验证回测集。我
们取2005-2018 年为训练集，其中抽取 20% 为测
试集。将2019 年数据作为验证回测集合。初始化
股票仓位为空仓，当预测下一天趋势为涨，当日
买入1/3 金额，若预测为跌，则卖出1/3金额的
仓位。若满仓、空仓则分别不进行买入、卖出操
作。
本实验使用的是单只股票的交易数据五元组，
我们分别测试了贵州茅台、工商银行、比亚迪三
只股票。下面实验数据以贵州茅台举例。
实验共进行了200 个 epoch，初始学习率为
0.01，每进行 5 个 epoch 学习率变为原来的 0.9，
优化器为SGD。在每一个循环中统计其训练误差
（蓝色线）、测试误差（黄色线）、测试准确率，并
且画出图如figure 2。下面是关于 figure 2的一些
解释：
• Training Loss 波动但大趋势下降：波动可能
表明学习率设置不太稳定或数据集中存在一
些不规则特征。
• Test Loss 先升高后下降：初始升高可能表明
模型在最初阶段对测试数据过拟合或学习率
较高。学习率下降之后效果逐渐变好。
• Test Accuracy 先不变后缓慢升高：初始学习
率过高或者特征难以把握，随后的缓慢提升
表明模型逐渐开始泛化。最终accuracy 稳定
在0.54 左右波动。
Figure 2: Loss and accuracy of Training
我们通过记录下训练过程中accuracy 最高的
模型，然后使用它来进行验证回测。输入前60天
的[开盘、收盘、市值、市盈率、最高价]五元组
作为特征，当预测下一天趋势为涨，当日买入1/3
金额，若预测为跌，则卖出1/3金额的仓位。若
满仓、空仓则分别不进行买入、卖出操作。本实验
中使用BigQuant 作为回测平台。其中使用茅台
的数据回测时，回测结果如figure3所示。红色线
为回测结果，蓝色线为基准收益率。
7
Figure 4: 随机森林代码架构
Figure 3: Results of model backtesting
下面是本实验的一些关键结果的数值
回测收益-茅台
结果参数
数值
年化收益率 62.24%
基准收益率 36.07%
夏普比率
2.27
收益波动率 21.0%
 Table 1: 以茅台为例的实验数据
根据上述结果可以看到，模型能够在过去取
得不错的效果。不过由于本实验的模型较为简单，
对于不同类型的股票性能不尽相同。且模型对于
不同规律的捕捉较为迟钝，比如疫情到来之后，模
型对于变化之后的环境，适应度不足。具体的针
对卷积神经网络的即时改进，还有待下一步探索。
4.2. 随机森林
4.2.1. 实验环境与参数
使用QuantConnect 平台进行随机森林算法
建模和测试与验证[27]。QuantConnect 是一个开
源、云基础的算法交易平台，为用户提供股票、外
汇、期货、期权、衍生品和加密货币等多种市场的
算法交易服务。我们使用该平台的可视化策略来
完成建模。下面是代码架构
代码中比较重要的是 m19。m19 的 handle
 data 方法用于每日数据处理函数，每天执行一次。
先按日期过滤得到今日的预测数据。然后是资金
分配，平均持仓时间是hold days（后面简称 h），
每日都将买入股票，每日预期使用 1/h 的资金。
实际操作中，会存在一定的买入误差，所以在前
h 天，等量使用资金；之后，尽量使用剩余资金。
接着生成卖出订单，h 天之后才开始卖出；对持
仓的股票，按机器学习算法预测的排序末位淘汰。
最后生成买入订单，按机器学习算法预测的排序，
买入前面一定数量股票，需要确保股票持仓量不
会超过每次股票最大的占用资金量。initialize 方
法是初始化函数。先加载预测数据,设置交易手续
费和滑点。接着设置买入的股票数量，这里默认
买入预测股票列表排名靠前的5只，不过后来经
过不断调参，发现这里设成20以上后效果明显更
好，35 的时候最好。最后设置的股票的权重，该
权重分配会使得靠前的股票分配多一点的资金。
4.2.2. 实验结果
获取 2010-2015 年 A 股交易数据进行学习，
预测2015-2016 的股票。经过不断调参，随机森
林的参数选择如下：
树的数量
60
特征使用率
0.8
树的最大深度
5
每叶子节点最小样本数 500
我们尝试改变参数来优化回测结果，根据调
研的论文提供的信息，决策树的个数越多，模型
越复杂，计算速度越慢；每棵树的最大深度大则
8
拟合能力强，数值小则泛化能力强；每个叶子节
点最少样本数：数值大泛化能力强，数值小拟合
能力强。但是经过实验发现，改变这些对实际决
策的影响都很小，反而是买入的股票数量对回测
效果影响很大。默认为5的时候效果很差，到了
20 以上会比较好。下面是35 时候，也就是最好
情况的回测数据：
Figure 5: 随机森林算法收益率
运行天数 365天
最大回撤 35.83%
年化收益率 74.52%
夏普比率 1.59
信息比率 0.18
参考论文中的最好结果是2.25的夏普比率和
84.96% 的年回报率，可以看出我们的模型与论文
中仍有差距。考虑到决策树数量、树最大深度、每
叶节点等与过拟合相关的参数调整后模型的决策
变化不大，我们认为与论文的差距是是模型的实
现细节导致的。但整体而言，最终回测数据还是
比较理想，说明随机森林算法用于选股有不错的
效果。
4.3. 配对算法
4.3.1. 实验环境
本研究采用QuantConnect 平台进行算法交
易的测试与验证[27]。QuantConnect是一个开源、
云基础的算法交易平台，为用户提供股票、外汇、
期货、期权、衍生品和加密货币等多种市场的算
法交易服务。该平台支持Python 和 C# 等多种
编程语言，并通过其LEAN算法交易引擎实现算
法的设计、回测和交易[28]。
在QuantConnect 平台 [27] 上，我们实验了
配对交易策略[14]，该策略基于统计套利理念，寻
找并交易两个价格序列之间的长期关系。交易算
法主要通过计算两只 ETF 之间的协整关系和相
关性，来识别和利用资产价格的微小偏差。在策
略构建中，实验选择了多个ETF作为潜在的交易
对，并通过Pearson 相关系数模型 [29] 和协整向
量模型[30] 来选择最佳配对并构建投资组合。
4.3.2. 实验方法
配对交易算法通过QuantConnect 平台实施，
选取包括IYM、XLE、XLK、XLF 和 XLI 在内
的ETF 作为可交易对象。算法启动日期为2020
年4月8日，初始资金设定为100万美元。在实
现上，设置回溯窗口60天来计算相关性和协整关
系，预期利润率至少为2%以覆盖交易费用。此
外，算法使用分钟级分辨率数据，并通过滚动窗
口和日志收益指标来分析和预测各ETF 之间的
协整向量[30]。
Pearson 相关系数和协整关系。Pearson 相
关系数度量两个变量之间的线性相关性，公式为
[29]：
r =
 (xi − ¯ x)(yi − ¯ y)
 (xi − ¯ x)2 (yi − ¯ y)2
协整关系则用于检测不同时间序列之间的长
期稳定关系。Engle-Granger 协整测试是识别协整
关系的一种方法[coint ]，通过以下回归模型进行：
Yt = α+βXt+ϵt
其中，如果残差序列ϵt 是平稳的，则Yt 和
Xt 被认为是协整的。
4.3.3. 实验结果
策略在 1293 个交易日内运行，期间最大回
撤为14.4%。交易周转率为 11%，显示策略具有
适度的交易活动。年化复合增长率（CAGR）为
1.7%，显示了策略在测试期间的增长能力。而夏
普比率为0.0，可能表明策略的收益与无风险收益
相当。信息比率为0.2，表明策略相对于基准的超
额回报。策略容量估计为240万美元。
9
运行天数
1293 天
最大回撤
0.2
策略容量（美元） 240万
14.4%
周转率
11%
年化复合增长率（CAGR） 1.7%
夏普比率
0.0
信息比率
0.2
每日交易次数
Figure 6: 配对算法收益率
4.4. 遗传算法
4.4.1. 实验环境与方法
我们在 BigQuant 平台实现了基于
Hirabayashi 提出的生成单股交易策略算法
的模型[22]。该模型选用的技术指标为MACD与
KDJ，每个个体使用 34 个比特编码技术指标的
参数及指标之间的关系。在计算个体适应性的部
分，我们根据平台提供的股票历史数据，通过模
拟交易得到个体的收益率，并将其作为个体的适
应性。模拟交易的主要流程如下：
• 初始化：由于部分技术指标使用股票历史股
价的加权平均值对股票的趋势进行分析预测，
如MACD指标使用的是股票前34个交易日
的股价指数加权平均。所以需要在进行交易
前使用股票的历史股价信息进行初始化。
• 交易：在每个交易日结束后，更新技术指标，
并根据策略发出的买卖信号进行操作：若当
前为空仓且策略发出买入信号，则在第二天
开盘时满仓对应股票；若当前满仓且策略发
出卖出信号，则在第二天开盘时平仓。
• 收益率计算：在模拟交易结束后，使用如下
公式计算收益率：
returns = cash+stock
 initial
 −1
其中，initial 为初始资金，cash 为交易结束
后的资金量，stock 为交易结束后股票市值。
同时，我们使用 BigQuant 平台提供的回测
功能测试生成的策略的收益率，其中交易流程与
上述遗传算法中模拟交易流程相同。
4.4.2. 实验数据与参数
我们使用南方航空公司2017 年 1 月1日至
2021 年 1 月1日的股价信息作为训练集，2021年
1 月1 日至2022 年 1 月1 日之间的股价信息作
为验证集，进行策略的生成及验证。其它的参数
如下：
个体数量 100
迭代次数 25
交叉互换概率 0.1
突变概率 0.7
 4.4.3. 实验结果
Figure 7: 遗传算法回测报告
在2021 年 1 月 1 日至2022 年 1 月 1 日之
间，“买入并持有”策略的收益率为15.42%，而生
成的策略的收益率为29.35%，高于“买入并持有
策略”13.93%。夏普比率为 1.13，表明生成的策
略有不错的表现。
然而，策略的最大回撤13.65%，收益波动率
为23.49%，仍有优化的空间。观察回测报告发现，
生成的策略在交易过程中满仓时间占比较大，导
致策略的收益受股价波动影响较大，这可能是策
略最大回撤以及收益波动率较大的原因之一。
5. 结论
我们小组以卷积神经网络、随机森林、配对
算法与遗传算法为代表，研究了人工智能在量化
10
金融领域中的应用，分别对其进行了模拟实验与
数据回测且效果令人满意，展示了人工智能在处
理量化金融领域有关问题的优越性。
在卷积神经网络的数据回测中，我们以贵州
茅台股票为例，发现在卷积神经网络的应用下取
得了相较于基准收益而言非常可观的收益率，并
把收益波动控制在了合理范围。但也在实践中发
现了模型对于不同规律的捕捉较为迟钝，比如疫
情到来之后，模型对于变化之后的环境，适应度
不足。卷积神经网络的即时改进依然有待优化。在
使用QuantConnect 平台对随机森林算法建模测
试的过程中，我们实现了74.52% 的年化收益率，
虽然由于实现细节方面的差异，与参考论文中的
84.96% 仍有一定差距，但是总体效果也令人满意，
体现了随机森林算法对选股的指导作用。同时我
们还发现了决策树数量、树最大深度与每叶节点
等于过拟合相关的参数调整后对决策在一定程度
上总体影响不大。在配对算法的研究中，我们让
选定的配对策略在1293个交易日模拟运行，取得
了比基准收益明显更高的收益，提现了配对算法
的优势。最后在遗传算法的模型中，我们的收益
率和夏普比率同样具有优势，同时发现了模型在
最大回撤与收益波动方面仍有优化空间。
总体而言，在我们的模拟实验与数据回测之
中，模型在收益率与夏普比率方面的优势明显，提
供了具有参考价值的实践成果与实验数据。同时，
我们通过模拟实验也发现了领域内现有理论模型
在处理具体问题时的一些局限性与不足，对量化
金融的决策与优化给出了合理建议与改进方向，
对于人工智能参与下的量化金融决策及其未来的
优化与改良都有借鉴意义。